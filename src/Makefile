# Usual compilation flags
CFLAGS   = -Wall -Wextra -std=c11 -DDEBUG -g
CPPFLAGS = -I../include
LDFLAGS  = -lcapstone

# Rules and targets
all: tracker

tracker: tracker.o executable.o trace.o
	$(CC) $(CFLAGS) -o $@ $^ $(LDFLAGS)

tracker.o: tracker.c tracker.h ../include/trace.h
	$(CC) $(CFLAGS) $(CPPFLAGS) -c -o $@ $<

executable.o: executable.c ../include/executable.h
	$(CC) $(CFLAGS) $(CPPFLAGS) -c -o $@ $<

trace.o: trace.c ../include/trace.h
	$(CC) $(CFLAGS) $(CPPFLAGS) -c -o $@ $<

format:
	clang-format -i -style=file *.[ch]

tidy:
	clang-tidy *.c *.h -config="" -- -std=c11 $(CPPFLAGS)
clean:
	@echo "src: Cleaning..."
	@rm -f *~ *.o tracker

help:
	@echo "Usage:"
	@echo "  make [all]\t\tBuild the software"
	@echo "  make format\t\tReformat the code"
	@echo "  make tidy\t\tPerform static-analysis on the code"
	@echo "  make clean\t\tRemove all files generated by make"
	@echo "  make help\t\tDisplay this help"

.PHONY: all clean help
